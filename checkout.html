<!DOCTYPE html>
<html>
<head>
  <title>SANGHX Checkout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Poppins',sans-serif;
      background:#fff7f5;
      padding:16px;
    }

    .box{
      background:white;
      border-radius:16px;
      padding:16px;
      box-shadow:0 10px 30px rgba(0,0,0,0.08);
      max-width:420px;
      margin:auto;
    }

    h2{margin-bottom:10px}
    input, textarea, select{
      width:100%;
      padding:10px;
      border-radius:10px;
      border:1px solid #ddd;
      margin:8px 0;
      font-family:inherit;
      outline:none;
    }

    button{
      width:100%;
      padding:12px;
      border:none;
      border-radius:12px;
      font-weight:800;
      cursor:pointer;
      margin-top:10px;
      transition:0.2s;
    }
    button:active{transform:scale(0.98);}

    .btn-wa{background:#25D366;color:white}
    .btn-back{background:#f2f2f2;color:#111}

    .items{
      font-size:14px;
      margin:10px 0;
      padding:10px;
      background:#f8f8f8;
      border-radius:12px;
      line-height:1.6;
    }

    .small{font-size:12px;opacity:0.7}
  </style>
</head>

<body>

  <div class="box">
    <h2>Checkout üßæ</h2>

    <div class="small">Your Order</div>
    <div class="items" id="orderItems">Loading...</div>

    <p style="margin-top:8px;"><b>Total:</b> ‚Çπ<span id="totalAmount">0</span></p>

    <input id="custName" placeholder="Your Name">
    <input id="custMobile" placeholder="Mobile Number">
    <textarea id="custAddress" placeholder="Delivery Address"></textarea>

    <select id="paymentMode">
      <option value="COD">Cash on Delivery</option>
      <option value="UPI">UPI</option>
    </select>

    <button class="btn-wa" onclick="sendWhatsAppOrder()">Send Order on WhatsApp</button>
    <button class="btn-back" onclick="goBack()">‚¨Ö Back</button>
  </div>

<script>
  const DELIVERY_CHARGE = 0;
  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  function safeText(str){
    return String(str || "");
  }

  function renderCheckout(){
    const div = document.getElementById("orderItems");

    if(cart.length === 0){
      div.innerHTML = "Cart is empty üòî<br><span class='small'>Go back and add some food.</span>";
      document.getElementById("totalAmount").innerText = 0;
      return;
    }

    div.innerHTML = "";
    cart.forEach(i=>{
      const lineTotal = i.price * i.qty;
      div.innerHTML += `‚úÖ <b>${safeText(i.name)} (${safeText(i.variantLabel)})</b> x${i.qty} = ‚Çπ${lineTotal}<br>
      <span class="small">üè™ ${safeText(i.storeName)}</span><br><br>`;
    });

    const subtotal = cart.reduce((t,i)=>t+i.price*i.qty,0);
    const total = subtotal + DELIVERY_CHARGE;
    document.getElementById("totalAmount").innerText = total;
  }

  function sendWhatsAppOrder(){
    const name = document.getElementById("custName").value.trim();
    const mobile = document.getElementById("custMobile").value.trim();
    const address = document.getElementById("custAddress").value.trim();
    const paymentMode = document.getElementById("paymentMode").value;

    if(!name || !mobile || !address){
      alert("Please fill all details");
      return;
    }

    if(cart.length === 0){
      alert("Cart is empty");
      return;
    }

    const totalAmount = cart.reduce((sum, i) => sum + i.price * i.qty, 0) + DELIVERY_CHARGE;

    let itemsText = cart.map(i => `‚Ä¢ ${i.name} (${i.variantLabel}) x${i.qty} = ‚Çπ${i.price*i.qty} - ${i.storeName}`).join("\n");

    const message = `
üõí New Order ‚Äì SANGHX

üë§ Name: ${name}
üìû Mobile: ${mobile}
üè† Address: ${address}
üí≥ Payment: ${paymentMode}

üì¶ Items:
${itemsText}

üöö Delivery: ‚Çπ${DELIVERY_CHARGE}
üí∞ Total: ‚Çπ${totalAmount}
`;

    window.open(`https://wa.me/919322586177?text=${encodeURIComponent(message)}`, "_blank");

    // Clear cart
    localStorage.removeItem("cart");
    cart = [];

    setTimeout(()=>{
      window.location.href = "customer.html";
    }, 800);
  }

  function goBack(){
    window.location.href = "customer.html";
  }

  renderCheckout();
</script>

</body>
</html>
